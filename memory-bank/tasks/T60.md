# T60: Remove complex.ts and Direct Math.js Integration
*Created: 2025-05-08*
*Last Updated: 2025-05-08*

## Description
Complete removal of complex.ts module and direct integration of math.js complex number operations across all quantum modules for improved maintainability and performance.

## Status
ðŸ”„ In Progress

## Priority
HIGH

## Dependencies
- T56 (Quantum Library Code Reorganization)
- T59 (To be superseded by this task)

## Progress

### Completed Changes
- âœ… Updated types.ts to use math.js Complex type directly
- âœ… Removed complex.ts imports and updated matrixOperations.ts
- âœ… Fixed eigendecomposition handling in matrixOperations.ts
- âœ… Fixed unitary operator validation in matrixOperations.ts
- âœ… Updated operator.ts to use math.js methods directly
- âœ… Updated stateVector.ts to use math.js methods directly
- âœ… Updated information.ts to use math.js methods directly
- âœ… Updated index.ts to remove complex.ts exports
- âœ… Updated matrixFunctions.ts to use math.js methods directly
- âœ… Updated gates.ts to use math.js methods directly
- âœ… Updated oscillator.ts to use math.js methods directly
- âœ… Updated measurement.ts to use math.js methods directly
- âœ… Updated hilbertSpace.ts to use math.js methods directly
- âœ… Updated hamiltonian.ts to use math.js methods directly
- âœ… Updated densityMatrix.ts to use math.js methods directly
- âœ… Updated states.ts to use math.js methods directly

### Additional Completed Changes
- âœ… Simplified isUnitary implementation using math.js matrix operations
- âœ… Simplified eigenDecomposition implementation with proper Complex type handling
- âœ… Fixed matrix operation tests to work with math.js outputs
- âœ… Removed unused powerIteration and deflateMatrix functions
- âœ… Updated test suite to handle math.js matrix formats

### Final Steps
1. Remove complex.ts file
2. Run tests to verify all functionality
3. Update documentation to reflect direct math.js usage

## Updated Implementation Details
### Phase 1: Core Module Updates (âœ… Completed)
- Updated types.ts to use math.js Complex type directly
- Removed compatibility layer from core modules
- Updated matrixOperations.ts
- Updated operator.ts
- Updated stateVector.ts
- Simplified matrix operations using direct math.js functions
- Fixed type handling in eigenDecomposition
- Improved test coverage for matrix operations

### Breaking Changes Note
- Users importing complex number operations directly from the library should now use math.js methods
- Example migration:
  ```typescript
  // Old code
  import { createComplex, addComplex } from 'spin_network_app/quantum';
  
  // New code
  import { Complex } from 'spin_network_app/quantum';
  import * as math from 'mathjs';
  ```

### Remaining Files to Update
1. operatorAlgebra.ts
2. information.ts
3. index.ts
4. matrixFunctions.ts
5. oscillator.ts
6. measurement.ts
7. gates.ts
8. hilbertSpace.ts
9. hamiltonian.ts
10. densityMatrix.ts
11. states.ts

### Steps for Each File
1. Remove complex.ts import
2. Import Complex type from mathjs
3. Replace complex.ts function calls with math.js equivalents:
   - createComplex() â†’ math.complex()
   - addComplex() â†’ math.add()
   - multiplyComplex() â†’ math.multiply()
   - conjugateComplex() â†’ math.conj()
   - modulusComplex() â†’ math.abs()
   - divideComplex() â†’ math.divide()
   - isZeroComplex() â†’ math.abs() < tolerance
   - phaseComplex() â†’ math.arg()
   - fromPolar() â†’ math.multiply(r, math.exp(math.complex(0, theta)))
   - expComplex() â†’ math.exp(math.complex(0, theta))
4. Update any tests referencing these functions

## Implementation Details

### Phase 1: Core Module Updates (âœ… Completed)
- Updated types.ts to use math.js Complex type directly
- Removed compatibility layer from core modules
- Updated matrixOperations.ts
- Updated operator.ts
- Updated stateVector.ts

### Phase 2: Module Updates (ðŸ”„ In Progress)
- Updating remaining quantum modules:
  - [ ] operatorAlgebra.ts
  - [ ] information.ts
  - [ ] index.ts
  - [ ] matrixFunctions.ts
  - [ ] oscillator.ts
  - [ ] measurement.ts
  - [ ] gates.ts
  - [ ] hilbertSpace.ts
  - [ ] hamiltonian.ts
  - [ ] densityMatrix.ts
  - [ ] states.ts

### Phase 3: Testing and Documentation (â¬œ Pending)
- Update tests to use math.js methods directly
- Update documentation to reflect math.js usage
- Remove complex.ts file
- Update index.ts exports

## Notes
- Math.js provides better numerical stability
- Direct usage of math.js methods improves maintainability
- Enhanced type safety with math.js types

## Next Steps
1. Continue updating remaining modules in Phase 2
2. Update corresponding test files
3. Update documentation
4. Remove complex.ts